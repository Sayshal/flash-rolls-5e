{"version":3,"file":"ContestedRollDialog-DhWQ5iUD.js","sources":["../../src/components/ui/dialogs/ContestedRollDialog.mjs"],"sourcesContent":["import { MODULE_ID } from \"../../../constants/General.mjs\";\nimport { LogUtil } from \"../../utils/LogUtil.mjs\";\nimport { SettingsUtil } from \"../../utils/SettingsUtil.mjs\";\nimport { getSettings } from \"../../../constants/Settings.mjs\";\nimport { RollHelpers } from \"../../helpers/RollHelpers.mjs\";\nimport { ChatMessageManager } from \"../../managers/ChatMessageManager.mjs\";\n\n/**\n * Contested Roll Dialog for requesting different roll types from selected actors\n */\nconst { ApplicationV2, HandlebarsApplicationMixin } = foundry.applications.api;\nexport class ContestedRollDialog extends HandlebarsApplicationMixin(ApplicationV2) {\n  constructor(options = {}) {\n    super(options);\n    this.actors = options.actors || [];\n    this.rollSelections = new Map();\n    this.rollMode = \"publicroll\";\n    this.flavor = \"\";\n    this.hideNpcNames = false;\n  }\n\n  /**\n   * Default application configuration\n   */\n  static DEFAULT_OPTIONS = {\n    id: \"flash5e-contested-roll-dialog\",\n    classes: [\"flash5e-dialog\", \"flash5e-contested-roll-dialog\"],\n    tag: \"div\",\n    window: {\n      title: \"FLASH_ROLLS.ui.dialogs.contestedRoll.title\",\n      icon: \"fas fa-swords\",\n      resizable: false,\n      positioned: true,\n      frame: true\n    },\n    position: {\n      width: 540,\n      height: \"auto\"\n    },\n    actions: {\n      request: ContestedRollDialog.prototype._onRequest,\n      \"show-code\": ContestedRollDialog.prototype._onShowCode\n    }\n  };\n\n  /**\n   * Define template parts\n   */\n  static PARTS = {\n    main: {\n      template: `modules/${MODULE_ID}/templates/contested-roll-dialog.hbs`\n    }\n  };\n\n  /**\n   * Prepare application rendering context\n   */\n  async _prepareContext(options = {}) {\n    const context = await super._prepareContext(options);\n\n    const abilities = {};\n    for (const [key, config] of Object.entries(CONFIG.DND5E.abilities)) {\n      abilities[key] = {\n        label: game.i18n.localize(config.label),\n        abbreviation: game.i18n.localize(config.abbreviation)\n      };\n    }\n\n    const skills = {};\n    for (const [key, config] of Object.entries(CONFIG.DND5E.skills)) {\n      skills[key] = {\n        label: game.i18n.localize(config.label)\n      };\n    }\n\n    return {\n      ...context,\n      actors: this.actors.map(a => {\n        const actor = a.actor || a;\n        return {\n          id: actor.id,\n          name: actor.name,\n          img: actor.img\n        };\n      }),\n      abilities,\n      skills,\n      rollMode: this.rollMode,\n      flavor: this.flavor,\n      hideNpcNames: this.hideNpcNames\n    };\n  }\n\n  /**\n   * Attach event listeners\n   */\n  _attachPartListeners(partId, htmlElement, options) {\n    super._attachPartListeners(partId, htmlElement, options);\n\n    const rollModeSelect = htmlElement.querySelector('.roll-mode-select');\n    if (rollModeSelect) {\n      rollModeSelect.addEventListener('change', (event) => {\n        this.rollMode = event.target.value;\n      });\n    }\n\n    const flavorInput = htmlElement.querySelector('input[name=\"flavor\"]');\n    if (flavorInput) {\n      flavorInput.addEventListener('input', (event) => {\n        this.flavor = event.target.value;\n      });\n    }\n\n    const hideNpcCheckbox = htmlElement.querySelector('input[name=\"hideNpcNames\"]');\n    if (hideNpcCheckbox) {\n      hideNpcCheckbox.addEventListener('change', (event) => {\n        this.hideNpcNames = event.target.checked;\n      });\n    }\n\n    const actorRollSelects = htmlElement.querySelectorAll('.actor-roll-type');\n    actorRollSelects.forEach(select => {\n      select.addEventListener('change', (event) => {\n        const actorId = event.target.dataset.actorId;\n        this.rollSelections.set(actorId, event.target.value);\n      });\n    });\n  }\n\n  /**\n   * Handle request button click\n   */\n  async _onRequest(event, target) {\n    if (this.actors.length === 0) {\n      ui.notifications.warn(game.i18n.localize(\"FLASH_ROLLS.notifications.noActorsSelected\"));\n      return;\n    }\n\n    for (const actorEntry of this.actors) {\n      const actor = actorEntry.actor || actorEntry;\n      const selection = this.rollSelections.get(actor.id);\n      if (!selection) {\n        ui.notifications.warn(game.i18n.format(\"FLASH_ROLLS.notifications.noRollSelected\", { name: actor.name }));\n        return;\n      }\n    }\n\n    const result = {\n      actors: this.actors.map(actorEntry => {\n        const actor = actorEntry.actor || actorEntry;\n        return {\n          actor: actor,\n          uniqueId: actorEntry.uniqueId || actor.id,\n          tokenId: actorEntry.tokenId || null,\n          rollType: this.rollSelections.get(actor.id)\n        };\n      }),\n      rollMode: this.rollMode,\n      flavor: this.flavor,\n      hideNpcNames: this.hideNpcNames\n    };\n\n    await this._executeContestedRolls(result);\n    this.close();\n  }\n\n  /**\n   * Execute contested rolls for all actors\n   */\n  async _executeContestedRolls(config) {\n    LogUtil.log('_executeContestedRolls', [config]);\n\n    const SETTINGS = getSettings();\n    const groupRollsMsgEnabled = SettingsUtil.get(SETTINGS.groupRollsMsgEnabled.tag);\n    const groupRollId = groupRollsMsgEnabled ? foundry.utils.randomID() : null;\n    LogUtil.log('ContestedRoll - groupRollId', [groupRollId]);\n\n    const contestedConfig = { ...config, isContestedRoll: true };\n\n    if (groupRollId) {\n      const actorEntries = config.actors.map(actorConfig => {\n        const actor = actorConfig.actor;\n        const uniqueId = actorConfig.uniqueId || actor.id;\n        const tokenId = actorConfig.tokenId || null;\n        return {\n          actor: actor,\n          uniqueId: uniqueId,\n          tokenId: tokenId\n        };\n      });\n\n      const firstRollType = config.actors[0].rollType.split(':');\n      const rollType = firstRollType[0] === 'ability' ? 'abilitycheck' : firstRollType[0];\n      const rollKey = firstRollType[1];\n\n      await ChatMessageManager.createGroupRollMessage(\n        actorEntries,\n        rollType,\n        rollKey,\n        contestedConfig,\n        groupRollId\n      );\n    }\n\n    for (const actorConfig of config.actors) {\n      await this._executeRollForActor(actorConfig, contestedConfig, groupRollId);\n    }\n  }\n\n  /**\n   * Execute a single roll for an actor\n   */\n  async _executeRollForActor(actorConfig, config, groupRollId = null) {\n    const actor = actorConfig.actor;\n    const tokenId = actorConfig.tokenId;\n    const [type, key] = actorConfig.rollType.split(':');\n\n    LogUtil.log('_executeRollForActor', [actor.name, type, key, 'tokenId:', tokenId, 'groupRollId:', groupRollId]);\n\n    const SETTINGS = getSettings();\n    const skipRollDialog = SettingsUtil.get(SETTINGS.skipRollDialog.tag);\n    const rollRequestsEnabled = SettingsUtil.get(SETTINGS.rollRequestsEnabled.tag);\n\n    try {\n      if (type === 'dice') {\n        const roll = await new Roll(key, actor.getRollData()).evaluate();\n\n        const speakerData = { actor };\n        if (tokenId) {\n          const token = canvas.tokens?.get(tokenId) || game.scenes.active?.tokens?.get(tokenId);\n          if (token) {\n            speakerData.token = token;\n          }\n        }\n        const speaker = ChatMessage.implementation.getSpeaker(speakerData);\n\n        const flavor = config.flavor || game.i18n.localize(\"FLASH_ROLLS.ui.dialogs.contestedRoll.customRoll\");\n\n        const messageData = {\n          speaker,\n          flavor\n        };\n\n        if (config.rollMode) {\n          messageData.rollMode = config.rollMode;\n        }\n\n        if (groupRollId) {\n          messageData.flags = {\n            \"flash-rolls-5e\": {\n              groupRollId: groupRollId,\n              isContestedRoll: true\n            }\n          };\n        }\n\n        await roll.toMessage(messageData);\n      } else {\n        const requestType = type === 'ability' ? 'abilitycheck' : type;\n        const isPlayerOwned = RollHelpers.isPlayerOwned(actor);\n\n        const uniqueId = tokenId || actor.id;\n\n        await FlashRolls5e.requestRoll({\n          requestType: requestType,\n          rollKey: key,\n          actorIds: [uniqueId],\n          sendAsRequest: isPlayerOwned && rollRequestsEnabled,\n          skipRollDialog: skipRollDialog,\n          groupRollId: groupRollId,\n          isContestedRoll: config.isContestedRoll || false\n        });\n      }\n    } catch (error) {\n      LogUtil.error('Error executing roll', [error]);\n      ui.notifications.error(game.i18n.format(\"FLASH_ROLLS.notifications.rollFailed\", { name: actor.name }), [error]);\n    }\n  }\n\n  /**\n   * Handle show code button click to create a macro\n   */\n  async _onShowCode(event, target) {\n    LogUtil.log('ContestedRollDialog _onShowCode', []);\n\n    for (const actorEntry of this.actors) {\n      const actor = actorEntry.actor || actorEntry;\n      const selection = this.rollSelections.get(actor.id);\n      if (!selection) {\n        ui.notifications.warn(game.i18n.format(\"FLASH_ROLLS.notifications.noRollSelected\", { name: actor.name }));\n        return;\n      }\n    }\n\n    const macroCode = this._generateMacroCode();\n    LogUtil.log('Generated macro code:', [macroCode]);\n\n    try {\n      await this._createContestedRollMacro(macroCode);\n      this.close();\n    } catch (error) {\n      LogUtil.error('Failed to create macro:', [error]);\n      ui.notifications.error(`Failed to create macro: ${error.message}`);\n    }\n  }\n\n  /**\n   * Generate macro code for the current configuration\n   */\n  _generateMacroCode() {\n    const firstRoll = this.rollSelections.get(this.actors[0].id).split(':');\n    const firstType = firstRoll[0] === 'ability' ? 'abilitycheck' : firstRoll[0];\n    const firstKey = firstRoll[1];\n\n    const rollCommands = this.actors.map(a => {\n      const [type, key] = this.rollSelections.get(a.id).split(':');\n      const requestType = type === 'ability' ? 'abilitycheck' : type;\n\n      if (type === 'dice') {\n        return `  // ${a.name}: Custom Dice Roll\n  const actor${a.id} = game.actors.get(\"${a.id}\");\n  if (actor${a.id}) {\n    const roll = await new Roll(\"${key}\", actor${a.id}.getRollData()).evaluate();\n    await roll.toMessage({\n      speaker: ChatMessage.implementation.getSpeaker({ actor: actor${a.id} }),\n      flavor: \"${this.flavor || 'Custom Roll'}\",\n      rollMode: \"${this.rollMode}\",\n      flags: {\n        \"flash-rolls-5e\": {\n          groupRollId: groupRollId,\n          isContestedRoll: true\n        }\n      }\n    });\n  }`;\n      } else {\n        return `  // ${a.name}: ${type}:${key}\n  await FlashRolls5e.requestRoll({\n    requestType: \"${requestType}\",\n    rollKey: \"${key}\",\n    actorIds: [\"${a.id}\"],\n    skipRollDialog: true,\n    groupRollId: groupRollId,\n    isContestedRoll: true\n  });`;\n      }\n    }).join('\\n\\n');\n\n    const actorEntriesCode = this.actors.map(a => `    {\n      actor: game.actors.get(\"${a.id}\"),\n      uniqueId: \"${a.id}\",\n      tokenId: null\n    }`).join(',\\n');\n\n    return `// Flash Rolls: Contested Roll\n// Roll Mode: ${this.rollMode}\n${this.flavor ? `// Flavor: ${this.flavor}` : ''}\n\n(async () => {\n  try {\n    const groupRollId = foundry.utils.randomID();\n\n    const actorEntries = [\n${actorEntriesCode}\n    ];\n\n    await FlashRolls5e.createGroupRollMessage(\n      actorEntries,\n      \"${firstType}\",\n      \"${firstKey}\",\n      { rollMode: \"${this.rollMode}\", flavor: \"${this.flavor}\", isContestedRoll: true },\n      groupRollId\n    );\n\n${rollCommands}\n  } catch (error) {\n    ui.notifications.error(\"Failed to execute contested roll: \" + error.message);\n  }\n})();`;\n  }\n\n  /**\n   * Create a macro with the contested roll configuration\n   */\n  async _createContestedRollMacro(command) {\n    const SETTINGS = getSettings();\n    const addMacrosToFolder = SettingsUtil.get(SETTINGS.addMacrosToFolder.tag);\n\n    let folderId = null;\n    if (addMacrosToFolder) {\n      folderId = await this._ensureFlashRollsFolder();\n    }\n\n    const actorNames = this.actors.map(a => a.name).join(' vs ');\n    const macroName = `Contested Roll: ${actorNames}`;\n\n    const macroDocumentData = {\n      name: macroName,\n      type: \"script\",\n      command: command,\n      img: \"modules/flash-rolls-5e/assets/bolt-circle.svg\",\n      ...(folderId && { folder: folderId }),\n      flags: {\n        \"flash-rolls-5e\": {\n          type: \"contested-roll\",\n          actors: this.actors.map(a => a.id),\n          rollSelections: Array.from(this.rollSelections.entries()),\n          rollMode: this.rollMode,\n          flavor: this.flavor\n        }\n      }\n    };\n\n    const macro = await Macro.create(macroDocumentData);\n    ui.notifications.info(game.i18n.format(\"FLASH_ROLLS.notifications.macroCreated\", {\n      macroName: macro.name\n    }));\n\n    macro.sheet.render(true);\n    return macro;\n  }\n\n  /**\n   * Ensure Flash Rolls folder exists for macro organization\n   */\n  async _ensureFlashRollsFolder() {\n    const folderName = \"Flash Rolls\";\n    let folder = game.folders.find(f => f.type === \"Macro\" && f.name === folderName);\n\n    if (!folder) {\n      try {\n        folder = await Folder.create({\n          name: folderName,\n          type: \"Macro\",\n          color: \"#302437\",\n          sort: 0\n        });\n        LogUtil.log('Created Flash Rolls macro folder', [folder]);\n      } catch (error) {\n        LogUtil.error('Failed to create Flash Rolls macro folder:', [error]);\n        ui.notifications.warn(\"Failed to create Flash Rolls macro folder. Macro will be created without folder organization.\");\n        return null;\n      }\n    }\n\n    return folder?.id || null;\n  }\n\n  /**\n   * Handle delete actor button click\n   */\n  async _onDeleteActor(event, target) {\n    const actorId = target.dataset.actorId;\n    LogUtil.log('ContestedRollDialog _onDeleteActor', [actorId]);\n\n    this.actors = this.actors.filter(a => a.id !== actorId);\n    this.rollSelections.delete(actorId);\n\n    await this.render(true);\n  }\n\n  /**\n   * Show the dialog\n   */\n  static async show(actors) {\n    if (!actors || actors.length === 0) {\n      ui.notifications.warn(game.i18n.localize(\"FLASH_ROLLS.notifications.noActorsSelected\"));\n      return null;\n    }\n\n    const dialog = new this({ actors });\n    dialog.render(true);\n    return dialog;\n  }\n}"],"names":["ApplicationV2","HandlebarsApplicationMixin","_ContestedRollDialog","options","context","abilities","key","config","skills","a","actor","partId","htmlElement","rollModeSelect","event","flavorInput","hideNpcCheckbox","select","actorId","target","actorEntry","result","LogUtil","SETTINGS","getSettings","groupRollId","SettingsUtil","contestedConfig","actorEntries","actorConfig","uniqueId","tokenId","firstRollType","rollType","rollKey","ChatMessageManager","type","skipRollDialog","rollRequestsEnabled","roll","speakerData","token","_a","_c","_b","speaker","flavor","messageData","requestType","isPlayerOwned","RollHelpers","error","macroCode","firstRoll","firstType","firstKey","rollCommands","actorEntriesCode","command","addMacrosToFolder","folderId","macroDocumentData","macro","folderName","folder","f","actors","dialog","__publicField","MODULE_ID","ContestedRollDialog"],"mappings":"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"}